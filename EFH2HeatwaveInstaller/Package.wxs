<Wix xmlns="http://wixtoolset.org/schemas/v4/wxs" xmlns:ui="http://wixtoolset.org/schemas/v4/wxs/ui" xmlns:bal="http://wixtoolset.org/schemas/v4/wxs/bal">
  <Package Name="EFH-2" Manufacturer="USDA" Version="2.0.14.0" UpgradeCode="f1184f64-bad2-4f94-baaf-7820040c142a">
    <MajorUpgrade DowngradeErrorMessage="!(loc.DowngradeError)" />

	  <WixVariable Id="WixUILicenseRtf" Value="license.rtf"/>

	  <Icon Id="EFH2.ico" SourceFile="EFH2.ico"/>
	  <Property Id="ARPPRODUCTICON" Value="EFH2.ico"/>
	  
	  <ui:WixUI Id="WixUI_InstallDir" InstallDirectory="INSTALLFOLDER">
	  </ui:WixUI>

	  <Property Id="OLDVERSIONFOUND_DEFAULTLOCATION">
		  <RegistrySearch 
			  Id="CheckFor32BitApp" 
			  Root="HKLM" 
			  Key="SOFTWARE\WOW6432Node\Microsoft\Windows\CurrentVersion\Uninstall\{B384647C-9850-418D-8E33-EFDBDA225768}" 
			  Type="raw"
			  Name="DisplayName"
			  Bitness="always32" />
	  </Property>

	  <Launch Condition="NOT OLDVERSIONFOUND_DEFAULTLOCATION" Message="An older, 32-bit version of EFH-2 is installed on this system. Please uninstall it and re-run this installer."/>

	  <Media Id="1" Cabinet="cab1.cab" EmbedCab="yes"/>

    <Feature Id="Main" AllowAbsent="no" Description="The main components of the application, including WinTr20">
      <ComponentGroupRef Id="maincomp"/>
    </Feature>

	  <Feature Id="ProgramData" AllowAbsent="no" Description="Data used by EFH-2">
		  <ComponentGroupRef Id="programdatacomp"/>
	  </Feature>
	  
	  <Feature Id="Shortcut">
		  <Component Id="ShortcutComponent" Guid="EFF3A4CF-F09A-4D8F-A33A-0506ACDB76B6">
			  <Shortcut Id="ApplicationStartMenuShortcut"
						Directory="ApplicationProgramFolder"
						Advertise="no"
						Name="EFH-2"
						Description="EFH-2 application"
						Target="[INSTALLFOLDER]EFH2.exe"
						WorkingDirectory="INSTALLFOLDER">
			  </Shortcut>

			  <RemoveFolder On="uninstall" Id="ApplicationProgramFolder" Directory="ApplicationProgramFolder"/>
			  <RemoveFolder On="uninstall" Id="EngineeringApplicationsFolder" Directory="EngineeringApplicationsFolder"/>

			  <RegistryValue Root="HKCU" Key="Software\USDA\EFH-2" Name="installed" Type="integer" Value="1" KeyPath="yes"/>
		  </Component>
	  </Feature>
  </Package>
</Wix>
